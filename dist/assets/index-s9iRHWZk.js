import{j as e,B as A,q as _,r as i,k as ee,u as se,m as ae,C as le,D as ne,I as S,E as re,H as ce}from"./index-kz_KmYqn.js";import{C as q,a as V,c as W,e as te,b as ie,d as oe}from"./card-DezR5XwD.js";import{p as de,a as me,b as xe,c as z,P as he}from"./paginate-BLkFUQMB.js";import{T as je,a as pe,b as H,c as j,d as ue,e as p,B as T}from"./table-5kSjqWcC.js";import{z as m}from"./index-DXqQCM1T.js";import{L as Ne,u as fe,t as ge,F as be,a as b,b as v,c as w,d as C,e as y}from"./form-DcFddlnn.js";import{D as ve,a as we,b as Ce,c as ye,d as Re,e as Se}from"./dialog-DlAyJN_R.js";import{P as Pe}from"./phone-input-B6RuxzfW.js";import{f as ke,B as I}from"./index-QesZtENi.js";import{T as De,a as Ue,b as M,c as $}from"./tabs-C8HBKS2S.js";import{C as Te}from"./checkbox-BXesQf7w.js";import"./popover-DK1Sr0PN.js";import"./index-BEk9yI-S.js";import"./index-BbPOWOnj.js";import"./index-DuiSBcde.js";const Ee=({users:a,onUserSelect:c,selectedUser:o})=>e.jsxs(je,{children:[e.jsx(pe,{children:e.jsxs(H,{children:[e.jsx(j,{children:"User Name"}),e.jsx(j,{className:"hidden sm:table-cell",children:"Email"}),e.jsx(j,{className:"hidden sm:table-cell",children:"Contact No"}),e.jsx(j,{className:"hidden sm:table-cell",children:"First Name"}),e.jsx(j,{className:"hidden md:table-cell",children:"Last Name"}),e.jsx(j,{className:"hidden md:table-cell",children:"Roles"}),e.jsx(j,{className:"hidden md:table-cell",children:"Created On"}),e.jsx(j,{className:"hidden md:table-cell",children:"Actions"})]})}),e.jsx(ue,{children:a.map(n=>{var d,u;return e.jsxs(H,{className:`text-xs 2xl:text-sm ${o===n.id?"bg-accent":""}`,children:[e.jsx(p,{className:"font-medium",children:e.jsx("div",{className:"hover:cursor-pointer",onClick:()=>c==null?void 0:c(n.id),children:n.userName})}),e.jsx(p,{className:"hidden sm:table-cell",children:n.email||"-"}),e.jsx(p,{className:"hidden md:table-cell",children:e.jsx("div",{className:"font-medium",children:n.contactNo})}),e.jsx(p,{className:"hidden sm:table-cell",children:n.firstName}),e.jsx(p,{className:"hidden md:table-cell",children:n.lastName}),e.jsx(p,{className:"hidden md:table-cell",children:e.jsx("div",{className:"flex gap-1",children:(d=n.userRoles)==null?void 0:d.map(x=>e.jsx(T,{variant:"outline",children:x.role.value},x.id))})}),e.jsx(p,{className:"hidden md:table-cell",children:de(new Date(n.createdAt))}),e.jsx(p,{className:"hidden md:table-cell",children:e.jsx(A,{variant:"outline",size:"icon",disabled:(u=n.userRoles)==null?void 0:u.some(x=>x.role.value==="OWNER"),children:e.jsx(_,{})})})]},n.id)})})]}),Fe=Ee,Ie=(a,c)=>a.size===c.size&&[...a].every(o=>c.has(o)),Ae=({data:a,allRoles:c,onUpdateRole:o})=>{var D,R;const[n,d]=i.useState([]);i.useEffect(()=>{var l,t;(l=a.userRoles)!=null&&l.length?d(((t=a.userRoles)==null?void 0:t.map(P=>P.roleId))||[]):d([])},[a]);const u=l=>{const t=[...n];if(n.includes(l)){const P=n.findIndex(N=>N===l);t.splice(P,1),d(t)}else t.push(l),d(t)},x=()=>{o(n)},E=new Set(((D=a.userRoles)==null?void 0:D.map(l=>l.roleId))||[]),k=new Set(n),F=!Ie(E,k);return e.jsx(q,{className:"overflow-hidden",children:e.jsxs(De,{defaultValue:"details",className:"w-[400px]",children:[e.jsx(V,{className:"flex flex-row items-start",children:e.jsxs(Ue,{className:"grid w-full grid-cols-2",children:[e.jsx(M,{value:"details",children:"Details"}),e.jsx(M,{value:"roles",children:"Manage Roles"})]})}),e.jsxs(W,{className:"p-6 pt-0 text-sm",children:[e.jsxs($,{value:"details",className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"font-semibold",children:"Personal Details"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name"}),e.jsx("span",{children:a.firstName+" "+a.lastName})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Contact Number"}),e.jsx("span",{children:ke(a.contactNo)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Email"}),e.jsx("span",{children:a.email||"-"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"font-semibold",children:"Account Details"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"User Name"}),e.jsx("span",{children:a.userName})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Account Status"}),e.jsx("span",{children:a.isActive?e.jsx(T,{variant:"outline",children:"Active"}):e.jsx(T,{variant:"secondary",children:"Deactivated"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"font-semibold",children:"Roles & Permissions"}),e.jsx("div",{className:"flex flex-col gap-1",children:(R=a==null?void 0:a.userRoles)==null?void 0:R.map(l=>e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:e.jsx(T,{variant:"outline",children:l.role.value})}),e.jsx("span",{})]},l.id))})]})]}),e.jsxs($,{value:"roles",className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex flex-col gap-2",children:c.map(l=>e.jsxs("div",{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(Te,{checked:n==null?void 0:n.includes(l.id),onCheckedChange:()=>u(l.id)}),e.jsx(Ne,{children:l.value})]},l.id))}),e.jsx(I,{className:"w-full",disabled:!F,onClick:x,children:"Update Roles"})]})]}),e.jsxs(te,{className:"flex flex-row items-center border-t bg-muted/50 px-6 py-3",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Updated ",e.jsx("time",{dateTime:"2023-11-23",children:"November 23, 2023"})]}),e.jsx(me,{className:"ml-auto mr-0 w-auto",children:e.jsxs(xe,{children:[e.jsx(z,{children:e.jsx(I,{size:"icon",variant:"outline",className:"h-6 w-6",children:e.jsx("span",{className:"sr-only",children:"Previous Order"})})}),e.jsx(z,{children:e.jsx(I,{size:"icon",variant:"outline",className:"h-6 w-6",children:e.jsx("span",{className:"sr-only",children:"Next Order"})})})]})})]})]})})},Le=Ae,Be=m.object({userName:m.string().min(2).max(10),email:m.string().email().optional().or(m.literal("")),contactNo:m.string(),firstName:m.string(),lastName:m.string(),password:m.string().min(4),confirmPassword:m.string().min(4)}).superRefine(({confirmPassword:a,password:c},o)=>{a!==c&&o.addIssue({code:"custom",message:"The passwords did not match",path:["confirmPassword"]})});function es(){const{shopId:a}=ee(),[c,o]=i.useState([]),[n,d]=i.useState([]),[u,x]=i.useState(""),E=se(s=>s.auth),[k,F]=i.useState(0),[D,R]=i.useState(!1),l=fe({resolver:ge(Be),defaultValues:{userName:"",email:"",contactNo:"",firstName:"",lastName:"",password:"",confirmPassword:""}}),[t,P]=ae(),N=parseInt(t.get("page")||"0"),h=20,U=i.useCallback(async s=>{try{const r=await le({shopId:s.shopId,params:{skip:s.skip||0,take:s.take||h,includes:"userRoles"}});console.log(r.data),F(r.data.count),o(r.data.users)}catch(r){console.log(r)}},[]),G=i.useCallback(async()=>{try{const s=await ne();d(s.data.roles)}catch(s){console.log(s)}},[]);i.useEffect(()=>{if(a){const s=h*N;U({shopId:a,skip:s,take:h}),G()}},[a,U,E.data,N]);const J=s=>{console.log(s),P({...t,page:s.toString()})},K=async s=>{try{await ce(s),l.reset(),R(!1);const r=h*N;a&&U({shopId:a,skip:r,take:h})}catch(r){console.log(r)}};function Q(s){if(console.log(s),a){const r={userName:s.userName,password:s.password,firstName:s.firstName,lastName:s.lastName,contactNo:s.contactNo,shopId:a,isActive:!0};s.email&&(r.email=s.email),K(r)}}const X=s=>{R(s),l.reset()},f=c.find(s=>s.id===u),Y=async s=>{if(f){const r=f==null?void 0:f.userRoles,L=[],B=[];s==null||s.forEach(g=>{(r==null?void 0:r.find(Z=>Z.roleId===g))||B.push({roleId:g,userId:f.id})}),r==null||r.forEach(g=>{s.includes(g.roleId)||L.push(g.id)});const O={create:B,delete:L};if(await re(O),a){const g=h*N;await U({shopId:a,skip:g,take:h}),console.log(O)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Shop Users"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(A,{onClick:()=>R(!0),children:"New User"})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col flex-1 gap-4",children:[e.jsxs(q,{children:[e.jsxs(V,{className:"px-7",children:[e.jsx(ie,{children:"Users"}),e.jsxs(oe,{children:["(Showing ",c.length,"/",k,") users from your store."]})]}),e.jsx(W,{children:e.jsx(Fe,{users:c,onUserSelect:x,selectedUser:u})})]}),c.length?e.jsx(he,{totalCount:k,maxPages:5,itemsPerPage:h,value:N,onChange:J}):null]}),f&&e.jsx("div",{children:e.jsx(Le,{data:f,allRoles:n.filter(s=>!["OWNER","ADMIN"].includes(s.value)),onUpdateRole:Y})})]})]}),e.jsx(ve,{open:D,onOpenChange:X,children:e.jsx(we,{className:"sm:max-w-[600px]",children:e.jsx(be,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(Q),children:[e.jsxs(Ce,{children:[e.jsx(ye,{children:"Create New User"}),e.jsx(Re,{children:"Fill up the details. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{control:l.control,name:"firstName",render:({field:s})=>e.jsxs(v,{className:"col-span-1",children:[e.jsx(w,{children:"First Name"}),e.jsx(C,{children:e.jsx(S,{placeholder:"Enter first name",...s})}),e.jsx(y,{})]})}),e.jsx(b,{control:l.control,name:"lastName",render:({field:s})=>e.jsxs(v,{className:"col-span-1",children:[e.jsx(w,{children:"Last Name"}),e.jsx(C,{children:e.jsx(S,{placeholder:"Enter last name",...s})}),e.jsx(y,{})]})})]}),e.jsx(b,{control:l.control,name:"userName",render:({field:s})=>e.jsxs(v,{children:[e.jsx(w,{children:"User Name"}),e.jsx(C,{children:e.jsx(S,{placeholder:"Enter user name",...s})}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{control:l.control,name:"password",render:({field:s})=>e.jsxs(v,{className:"col-span-1",children:[e.jsx(w,{children:"Password"}),e.jsx(C,{children:e.jsx(S,{type:"password",placeholder:"Enter password",...s})}),e.jsx(y,{})]})}),e.jsx(b,{control:l.control,name:"confirmPassword",render:({field:s})=>e.jsxs(v,{className:"col-span-1",children:[e.jsx(w,{children:"Confirm Password"}),e.jsx(C,{children:e.jsx(S,{placeholder:"Enter password again",...s})}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{control:l.control,name:"contactNo",render:({field:s})=>e.jsxs(v,{className:"col-span-1",children:[e.jsx(w,{children:"Contact Number"}),e.jsx(C,{children:e.jsx(Pe,{placeholder:"Enter a phone number",defaultCountry:"IN",...s})}),e.jsx(y,{})]})}),e.jsx(b,{control:l.control,name:"email",render:({field:s})=>e.jsxs(v,{className:"col-span-1",children:[e.jsx(w,{children:"Email Id"}),e.jsx(C,{children:e.jsx(S,{placeholder:"Enter email id ",...s})}),e.jsx(y,{})]})})]}),e.jsx(Se,{children:e.jsx(A,{type:"submit",children:"Save changes"})})]})]})})})})]})}export{es as default};
